<!DOCTYPE html>
<meta charset="utf-8">
<title>Budget API Test</title>
<body>
  <input type="button" id="getDocBudget" onclick="getDocBudget()" value="Get Current Budget in doc"></input>
  <h2>Budget from document: </h2>
  <pre id="docBudget"></pre>
  <input type="button" id="getSWBudget" onclick="getSWBudget()" value="Get Current Budget in service-worker"></input>
  <h2>Budget from sw: </h2>
  <pre id="swBudget"></pre>
  <input type="button" id="getCost" onclick="getCost()" value="Get Cost">
  <pre id="theCost"></pre>
</body>
<script>
function getDocBudget() {
  navigator.budget.getBudget().then(function(b) {console.log("budget state:" + b.length); for (bs of b) {budgetInfo = "Budget is " + bs.budgetAt.toString() + " at " + new Date(bs.time).toString();console.log(budgetInfo); document.getElementById("docBudget").innerHTML += budgetInfo + "\n" }});
}
function getSWBudget() {
  if (navigator.serviceWorker.controller) {
      navigator.serviceWorker.controller.postMessage("");
  }
}
function getCost() {
  navigator.budget.getCost("push-api").then(function(b) {console.log("budget state:" + b.length); for (bs of b) {budgetInfo = "Budget is " + bs.budgetAt.toString() + " at " + new Date(bs.time).toString();console.log(budgetInfo); document.getElementById("docBudget").innerHTML += budgetInfo + "\n" }});
}
if (navigator.serviceWorker && navigator.serviceWorker.register) {
    if (!navigator.serviceWorker.controller) {
      navigator.serviceWorker.register("budget_sw.js")
        .catch(function(error) {
            console.log("SW reg failed: " + error.message);
        });
    } else {
      navigator.serviceWorker.addEventListener("message", function(event) {
          document.getElementById("swBudget").innerHTML += event.data + "\n"; 
      });
    }
}
</script>
